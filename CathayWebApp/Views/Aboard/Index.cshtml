@{
    Layout = "~/Views/Aboard/shared/_template.cshtml";
    ViewData["PageTitle"] = "國泰世華銀行香港分行";
        // Mock ListOfNews data
    var  currentLanguage = ViewData["lang"] as string;
    var mockNews = new List<dynamic>
    { 
        new {
            Id = 1,
            Title = currentLanguage switch
            {
                "zh-hant" => "1. 國泰世華銀行最新服務公告~~~",
                "en" => "Cathay United Bank Latest Service Announcement",
                "km" => "ការប្រកាសសេវាកម្មចុងក្រោយរបស់ធនាគារ Cathay United",
                _ => "國泰世華銀行最新服務公告"
            },
            Summary = currentLanguage switch
            {
                "zh-hant" => "為提供更優質的金融服務，本行將推出全新數位銀行功能。",
                "en" => "To provide better financial services, we are launching new digital banking features.",
                "km" => "ដើម្បីផ្តល់សេវាកម្មហិរញ្ញវត្ថុកាន់តែប្រសើរ យើងកំពុងបើកដំណើរការលក្ខណៈពិសេសធនាគារឌីជីថលថ្មី។",
                _ => "為提供更優質的金融服務，本行將推出全新數位銀行功能。"
            },
            PublishDate = DateTime.Now.AddDays(-1),
            Url = "/news/digital-banking-features"
        },
        new {
            Id = 2,
            Title = currentLanguage switch
            {
                "zh-hant" => "2. 匯率優惠活動開跑",
                "en" => "Special Exchange Rate Promotion",
                "km" => "ការផ្តល់ជូនអត្រាប្តូរប្រាក់ពិសេស",
                _ => "匯率優惠活動開跑"
            },
            Summary = currentLanguage switch
            {
                "zh-hant" => "3. 即日起至月底，享受更優惠的外幣兌換服務。",
                "en" => "From now until the end of the month, enjoy better foreign exchange rates.",
                "km" => "ចាប់ពីឥឡូវនេះរហូតដល់ចុងខែ រីករាយជាមួយអត្រាប្តូរប្រាក់បរទេសប្រសើរជាង។",
                _ => "即日起至月底，享受更優惠的外幣兌換服務。"
            },
            PublishDate = DateTime.Now.AddDays(-3),
            Url = "/news/exchange-rate-promotion"
        },
        new {
            Id = 3,
            Title = currentLanguage switch
            {
                "zh-hant" => "ATM服務據點擴展通知",
                "en" => "ATM Service Point Expansion Notice",
                "km" => "ការជូនដំណឹងពីការពង្រីកចំណុចសេវាកម្ម ATM",
                _ => "ATM服務據點擴展通知"
            },
            Summary = currentLanguage switch
            {
                "zh-hant" => "為方便客戶使用，新增多個ATM服務據點。",
                "en" => "For customer convenience, we have added multiple new ATM service points.",
                "km" => "ដើម្បីភាពងាយស្រួលរបស់អតិថិជន យើងបានបន្ថែមចំណុចសេវាកម្ម ATM ថ្មីជាច្រើន។",
                _ => "為方便客戶使用，新增多個ATM服務據點。"
            },
            PublishDate = DateTime.Now.AddDays(-7),
            Url = "/news/atm-expansion"
        }
    };
    ViewData["ListOfNews"] = mockNews;

    var mockBanners = new List<dynamic>
    {
        new { 
            index = 1, 
            title = currentLanguage switch 
            {
                "zh-hant" => "1. 申辦信用卡\n免年費",
                "en" => "Apply CUBC Credit Card\nFree Annual Fee", 
                "km" => "ដាក់ពាក្យសុំកាតឥណទាន CUBC\nគ្មានថ្លៃប្រចាំឆ្នាំ",
                _ => "申辦信用卡\n免年費"
            },
            url = "/banner/main",
            image = "~/assets/img/banners/1.png"
        },
        new { 
            index = 2, 
            title = currentLanguage switch 
            {
                "zh-hant" => "2. 匯率優惠\n限時活動",
                "en" => "Exchange Rate\nSpecial Promotion", 
                "km" => "អត្រាប្តូរប្រាក់\nកម្មវិធីពិសេស",
                _ => "匯率優惠\n限時活動"
            },
            url = "/banner/promo",
            image = "~/assets/img/banners/2.png"
        },
        new { 
            index = 3, 
            title = currentLanguage switch 
            {
                "zh-hant" => "3. 數位銀行\n全新體驗",
                "en" => "Digital Banking\nNew Experience", 
                "km" => "ធនាគារឌីជីថល\nបទពិសោធន៍ថ្មី",
                _ => "數位銀行\n全新體驗"
            },
            url = "/banner/seasonal",
            image = "~/assets/img/banners/3.png"
        }
    };
    ViewData["ListOfBanner"] = mockBanners;
}


<!-- This content will be rendered by the template's bodyPath -->


@if (ViewData["lang"] as string == "zh-hant")
{
    ViewData["PageTitle"] = "";
    ViewData["PageDescription"] = "國泰世華商業銀行香港分行於2002年2月1日 成立及註冊，提供一站式銀行服務，包括存匯、企業金融、貿易融資、私人銀行、埸外交易衍生工具等服務。此外，香港分行可透過網上銀行平台，提供優質的銀行服務。";
}
else
{
    ViewData["PageTitle"] = "";
    ViewData["PageDescription"] = "";
}

@section Scripts {

    <script type="text/javascript" src="@Url.Content("~/OVSWS/Content/js/lib/jquery.scrollbar.min.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/OVSWS/Content/js/lib/slick.min.js")"></script>


    <script>
        var homeCard = homeCard || {};
        homeCard.prototype = {
            sameHeight: function () {

                let window_w = $(window).width();
                let max_h = 0;
                let scope = $('.component-oversea-services');
                $('.cos-item-description', scope).css('min-height', 0);
                if (window_w >= 768) {
                    $('.cos-item', scope).each(function () {
                        let h = $('.cos-item-description', $(this)).height();
                        if (h > max_h) {
                            max_h = h;
                        }
                    })
                    $('.cos-item-description', scope).height(max_h);
                } else {
                    $('.cos-item-description', scope).css('height', 'auto');
                }
            },
            addEventListener: function () {
                let o = this;
                $(window).on('resize.homeCard', function () {
                    o.sameHeight();
                }).trigger('resize.homeCard');
            },
            init: function () {
                this.addEventListener();
            }
        }
    </script>

    <script>
        $(function () {

            var myHomeCard = homeCard.prototype;
            myHomeCard.init();

            // Banner Carousel Implementation
            var bannerCarousel = {
                currentIndex: 0,
                totalBanners: $('.oversea-kv__carousel-slide').length,
                autoPlayInterval: null,
                isTransitioning: false,
                
                init: function() {
                    if (this.totalBanners === 0) return;
                    this.setupEvents();
                    this.showSlide(0);
                    this.startAutoPlay();
                },
                
                setupEvents: function() {
                    var self = this;
                    
                    // Dot navigation
                    $('.oversea-kv__carousel-dot').on('click', function() {
                        if (self.isTransitioning) return;
                        var index = $(this).data('index');
                        self.goToSlide(index);
                    });
                    
                    // Arrow navigation
                    $('.oversea-kv__carousel-prev').on('click', function() {
                        if (self.isTransitioning) return;
                        self.prevSlide();
                    });
                    
                    $('.oversea-kv__carousel-next').on('click', function() {
                        if (self.isTransitioning) return;
                        self.nextSlide();
                    });
                    
                    // Pause on hover
                    $('.component-oversea-kv').hover(
                        function() { self.stopAutoPlay(); },
                        function() { self.startAutoPlay(); }
                    );
                    
                    // Keyboard navigation
                    $(document).on('keydown', function(e) {
                        if ($('.component-oversea-kv:hover').length > 0) {
                            if (e.keyCode === 37) { // Left arrow
                                e.preventDefault();
                                self.prevSlide();
                            } else if (e.keyCode === 39) { // Right arrow
                                e.preventDefault();
                                self.nextSlide();
                            }
                        }
                    });
                },
                
                showSlide: function(index) {
                    var self = this;
                    var $currentSlide = $('.oversea-kv__carousel-slide').eq(this.currentIndex);
                    var $nextSlide = $('.oversea-kv__carousel-slide').eq(index);
                    
                    // If this is the initial call or same index, just set the title without animation
                    if (index === this.currentIndex || !this.isTransitioning) {
                        this.currentIndex = index;
                        
                        // Set active slide
                        $('.oversea-kv__carousel-slide').removeClass('oversea-kv__carousel-slide--active');
                        $nextSlide.addClass('oversea-kv__carousel-slide--active');
                        
                        // Update dots
                        $('.oversea-kv__carousel-dot').removeClass('oversea-kv__carousel-dot--active');
                        $('.oversea-kv__carousel-dot').eq(index).addClass('oversea-kv__carousel-dot--active');
                        
                        // Set title immediately for initial load
                        var $title = $('.oversea-kv__dynamic-title');
                        var title = $nextSlide.data('title');
                        $title.html(title.replace(/\n/g, '<br>'));
                        
                        return;
                    }
                    
                    if (this.isTransitioning) return;
                    
                    this.isTransitioning = true;
                    
                    // Update current index
                    this.currentIndex = index;
                    
                    // Remove active class from current slide
                    $currentSlide.removeClass('oversea-kv__carousel-slide--active');
                    
                    // Add active class to next slide with slight delay for smooth transition
                    setTimeout(function() {
                        $nextSlide.addClass('oversea-kv__carousel-slide--active');
                        
                        // Update dots
                        $('.oversea-kv__carousel-dot').removeClass('oversea-kv__carousel-dot--active');
                        $('.oversea-kv__carousel-dot').eq(index).addClass('oversea-kv__carousel-dot--active');
                        
                        // Update title with fade effect
                        var $title = $('.oversea-kv__dynamic-title');
                        $title.fadeOut(200, function() {
                            var title = $nextSlide.data('title');
                            $title.html(title.replace(/\n/g, '<br>')).fadeIn(200);
                        });
                        
                        // Reset transition flag after animation completes
                        setTimeout(function() {
                            self.isTransitioning = false;
                        }, 600);
                    }, 50);
                },
                
                nextSlide: function() {
                    var nextIndex = (this.currentIndex + 1) % this.totalBanners;
                    this.goToSlide(nextIndex);
                },
                
                prevSlide: function() {
                    var prevIndex = (this.currentIndex - 1 + this.totalBanners) % this.totalBanners;
                    this.goToSlide(prevIndex);
                },
                
                goToSlide: function(index) {
                    this.stopAutoPlay();
                    this.showSlide(index);
                    this.startAutoPlay();
                },
                
                startAutoPlay: function() {
                    var self = this;
                    this.stopAutoPlay();
                    this.autoPlayInterval = setInterval(function() {
                        self.nextSlide();
                    }, 3000);
                },
                
                stopAutoPlay: function() {
                    if (this.autoPlayInterval) {
                        clearInterval(this.autoPlayInterval);
                        this.autoPlayInterval = null;
                    }
                }
            };
            
            // Initialize banner carousel
            if ($('.oversea-kv__carousel-slide').length > 0) {
                bannerCarousel.init();
            }
        })
    </script>
}

<div class='component-oversea-kv'>
    <div class="oversea-kv__content">
        <div class="oversea-kv__text">
            <h1 class='oversea-kv__title'>
                <span class='oversea-kv__dynamic-title'></span>
            </h1>
            @{ var newsList = ViewData["ListOfNews"] as IEnumerable<dynamic>; }
            @if (newsList?.Any() == true)
            {
                <div class='oversea-kv__news'>
                    <h2 class='oversea-kv__news-title'>@ViewData["home_latest_news"]</h2>
                    @foreach (var news in newsList)
                    {
                        <div class='oversea-kv__news-item'>
                            <span class='oversea-kv__news-date'>@news.PublishDate.ToString("yyyy-MM-dd")</span>
                            <p class='oversea-kv__news-content'>@news.Title</p>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
    
    <div class="oversea-kv__image">
        @{ var bannersList = ViewData["ListOfBanner"] as IEnumerable<dynamic>; }
        @if (bannersList?.Any() == true)
        {
            <div class="oversea-kv__carousel">
                @foreach (var banner in bannersList)
                {
                    
                    <div class="oversea-kv__carousel-slide @(banner.index == 1 ? "oversea-kv__carousel-slide--active" : "")" 
                         data-title="@banner.title" 
                         data-url="@banner.url">
                        <img class='oversea-kv__img' src='@Url.Content(banner.image)' alt='@banner.title' />
                    </div>
                }
                
                <!-- Navigation arrows -->
                <button class="oversea-kv__carousel-prev" aria-label="Previous slide">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <button class="oversea-kv__carousel-next" aria-label="Next slide">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                
                <!-- Dot indicators -->
                <div class="oversea-kv__carousel-dots">
                    @for (int i = 0; i < bannersList.Count(); i++)
                    {
                        <button class="oversea-kv__carousel-dot @(i == 0 ? "oversea-kv__carousel-dot--active" : "")" 
                                data-index="@i" 
                                aria-label="Go to slide @(i + 1)"></button>
                    }
                </div>
            </div>
        }
        else
        {
            <!-- Fallback static image -->
            <picture>
                <source media='(min-width: 992px)'
                        srcset='@Url.Content("~/assets/img/ui/bg-lg.jpg")' />
                <source media='(min-width: 768px)'
                        srcset='@Url.Content("~/assets/img/ui/bg-md.jpg")' />
                <img class='oversea-kv__img' src='@Url.Content("~/assets/img/ui/bg.jpg")' alt='海外據點'>
            </picture>
        }
    </div>
</div>
